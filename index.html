<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title></title>
<style>
body {
    font-size: 160px;
    text-align: center;
}
</style>
</head>
<body>

<div id="emoji"></div>
<div id="countdown"></div>

<script>
var countdown = document.getElementById('countdown');
var emoji = document.getElementById('emoji');


var search = window.location.search;
var query = {};
search.substring(1, search.length).split('&').forEach(function(pair) {
    pair = pair.split('=');
    query[pair[0]] = pair[1];
})

var data = {
    emoji: decodeURIComponent(query.e) || '?',
    time: {
        hours: 00,
        minutes: 00,
        seconds: 00,
    },
};

emoji.innerHTML = data.emoji;
document.title = data.emoji;

if (query.time) {
    var time = query.time.split(':');
    data.time.hours = parseInt(time[0], 10);
    data.time.minutes = parseInt(time[1], 10);
    if (time.length > 2) {
        data.time.seconds = parseInt(times[2], 10);
    }
}

if (query.date) {
    var date = query.date.split('-').reverse();
    data.time.date = date[0];
    date.length > 1 && (data.time.month = parseInt(date[1], 10) - 1)
    date.length > 2 && (data.time.fullYear = parseInt(date[2]))
}

var next = new Date();
for (var key in data.time) {
    var method = 'set' + key[0].toUpperCase() + key.substring(1, key.length);
    next[method] && next[method](data.time[key]);
}


function format(diff) {
    var until = {};
    // get total seconds between the times
    var delta = Math.abs(diff) / 1000;

    // calculate (and subtract) whole days
    var days = Math.floor(delta / 86400);
    delta -= days * 86400;
    until.day = days;

    // calculate (and subtract) whole hours
    var hours = Math.floor(delta / 3600) % 24;
    delta -= hours * 3600;
    until.hour = hours;

    // calculate (and subtract) whole minutes
    var minutes = Math.floor(delta / 60) % 60;
    delta -= minutes * 60;
    until.minute = minutes;

    // what's left is seconds
    var seconds = parseInt(delta % 60, 10);
    until.second = seconds;

    var output = ['day', 'hour', 'minute', 'second'].map(function (key) {
        var value = until[key];
        if (value || (key === 'second')) {
            return value + ' ' + key + (value === 1 ? '' : 's');
        }
        return undefined;
    }).filter(function (value) { return value !== undefined; });

    return output;
}

function append() {
    var now = new Date();
    var diff = next.getTime() - now.getTime();
    var str = format(diff);
    countdown.style.fontSize = '5vw';
    countdown.innerHTML = (diff < 0 ? '-' : '') + str.splice(0, str.length -1).join(', ') + ' and ' + str[str.length - 1];
}

window.setInterval(append, 1000);

append();
</script>

</body>
</html>
